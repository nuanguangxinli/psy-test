<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>心理咨询流派匹配测验</title>
    
    <!-- 引入国内加速的 React 和 Babel -->
    <script src="https://cdn.staticfile.org/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.staticfile.org/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.staticfile.org/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 设置基础样式 -->
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", sans-serif; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* 隐藏滚动条但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 图标组件 (SVG) ---
        const Icons = {
            Compass: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>,
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/></svg>,
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            BookOpen: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            ArrowRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            RefreshCw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            Heart: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            Map: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>,
            Sparkles: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 5H5"/><path d="M19 17v4"/><path d="M21 19h-4"/></svg>,
            CheckCircle2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
            SkipForward: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" x2="19" y1="5" y2="19"/></svg>,
            AlertCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Info: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            Book: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
        };

        // --- 雷达图组件 ---
        const RadarChart = ({ data, dimensionsConfig }) => {
            const size = 300;
            const center = size / 2;
            const radius = 100;
            
            const highestScore = Math.max(...Object.values(data));
            const maxScore = Math.max(highestScore * 1.1, 5); 

            const dimensions = Object.keys(dimensionsConfig);
            const angleStep = (Math.PI * 2) / dimensions.length;

            const getCoordinates = (value, index) => {
                const angle = index * angleStep - Math.PI / 2; 
                const r = (value / maxScore) * radius;
                const x = center + r * Math.cos(angle);
                const y = center + r * Math.sin(angle);
                return { x, y };
            };

            const points = dimensions.map((dim, i) => {
                const { x, y } = getCoordinates(data[dim] + 0.1, i); 
                return `${x},${y}`;
            }).join(' ');

            const backgroundPoints = dimensions.map((dim, i) => {
                const angle = i * angleStep - Math.PI / 2;
                const x = center + radius * Math.cos(angle);
                const y = center + radius * Math.sin(angle);
                return {x, y, label: dimensionsConfig[dim].label};
            });

            return (
                <div className="flex justify-center my-6 relative select-none">
                <svg width={size} height={size} className="overflow-visible">
                    {[0.2, 0.4, 0.6, 0.8, 1].map((scale, i) => (
                    <polygon
                        key={i}
                        points={dimensions.map((_, idx) => {
                        const angle = idx * angleStep - Math.PI / 2;
                        const r = radius * scale;
                        return `${center + r * Math.cos(angle)},${center + r * Math.sin(angle)}`;
                        }).join(' ')}
                        fill="none"
                        stroke="#e2e8f0"
                        strokeWidth="1"
                    />
                    ))}
                    {dimensions.map((_, i) => {
                    const angle = i * angleStep - Math.PI / 2;
                    const x = center + radius * Math.cos(angle);
                    const y = center + radius * Math.sin(angle);
                    return <line key={i} x1={center} y1={center} x2={x} y2={y} stroke="#e2e8f0" strokeWidth="1" />;
                    })}
                    <polygon points={points} fill="rgba(99, 102, 241, 0.25)" stroke="#6366f1" strokeWidth="2.5" strokeLinejoin="round" />
                    {backgroundPoints.map((pt, i) => (
                    <text 
                        key={i} 
                        x={pt.x} 
                        y={pt.y} 
                        textAnchor={pt.x > center ? "start" : pt.x < center ? "end" : "middle"}
                        dominantBaseline={pt.y > center ? "hanging" : "auto"}
                        className="text-xs fill-slate-500 font-medium"
                        dx={pt.x > center ? 10 : pt.x < center ? -10 : 0}
                        dy={pt.y > center ? 10 : pt.y < center ? -10 : pt.y === center ? 0 : -5}
                    >
                        {pt.label}
                    </text>
                    ))}
                </svg>
                </div>
            );
        };

        // --- 主应用组件 ---
        const PsychSchoolMatchApp = () => {
            const [currentStep, setCurrentStep] = useState('intro'); // intro, quiz, result
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [scores, setScores] = useState({
                rationality: 0,
                insight: 0,
                somatic: 0,
                systemic: 0,
                meaning: 0
            });
            
            const [skippedCount, setSkippedCount] = useState(0);
            const [selectedTherapy, setSelectedTherapy] = useState(null);
            const [activeDimensionInfo, setActiveDimensionInfo] = useState(null);
            const resultRef = useRef(null);

            // 维度数据
            const DIMENSIONS = {
                rationality: { label: '理性架构', color: '#3B82F6', icon: Icons.Brain, key: 'rationality' },
                insight: { label: '深层洞察', color: '#8B5CF6', icon: Icons.Map, key: 'insight' },
                somatic: { label: '躯体感知', color: '#10B981', icon: Icons.Activity, key: 'somatic' },
                systemic: { label: '系统/关系', color: '#F59E0B', icon: Icons.Users, key: 'systemic' },
                meaning: { label: '存在/叙事', color: '#EC4899', icon: Icons.BookOpen, key: 'meaning' }
            };

            const DIMENSION_DETAILS = {
                rationality: {
                    title: "理性架构 (Rationality)",
                    desc: "倾向于用**头脑**解决问题。认为人之所以痛苦，是因为想错了或者没方法。喜欢像修车一样修心理：找出故障点（错误的念头），换个零件（新的想法），然后上路。"
                },
                insight: {
                    title: "深层洞察 (Insight)",
                    desc: "关注**过去和潜意识**。觉得现在的痛苦只是地上的草，根在地下（童年）。如果不把根挖出来看看，光割草是没用的。相信“看见”本身就是治愈。"
                },
                somatic: {
                    title: "躯体感知 (Somatic)",
                    desc: "相信**身体的感觉**。觉得很多时候脑子还没反应过来，身体（心慌、胸闷、发抖）已经先知道了。认为治病得治“本能”，让身体里那股憋住的劲儿散出来。"
                },
                systemic: {
                    title: "系统/关系 (Systemic)",
                    desc: "看重**关系和环境**。觉得没有谁是能独自生病的，要么是家里其他人病了，要么是心里的不同部分在打架。不想只修一个人，想修整个“生态环境”。"
                },
                meaning: {
                    title: "存在/叙事 (Meaning)",
                    desc: "关注**故事和意义**。觉得人就是活一个“说法”。痛苦没关系，只要这痛苦有意义。不想被贴上“有病”的标签，想重新做自己人生故事的编剧。"
                }
            };

            const THERAPY_KNOWLEDGE_BASE = {
                "CBT (认知行为疗法)": {
                    summary: "目前全球应用最广泛、循证医学证据最充分的流派。",
                    philosophy: "核心理念是“认知决定情绪”。CBT认为，人的痛苦并非源于事件本身，而是源于对事件的非理性解释（认知扭曲）。",
                    process: "咨询过程结构化、短程且目标导向。治疗师会像“训练师”一样，帮助来访者识别自动思维（如“我搞砸了一次就是个废物”），通过苏格拉底式提问进行辩驳，并布置“行为实验”等家庭作业，建立新的神经回路。",
                    suitability: "适合希望快速缓解症状、喜欢逻辑分析、愿意完成课后练习的人。对抑郁、焦虑、强迫症有显著疗效。"
                },
                "SFBT (焦点解决短期治疗)": {
                    summary: "后现代流派中的“实用主义”代表，极度高效。",
                    philosophy: "相信“问题不等于人”，且“人不需深挖病因也能解决问题”。它关注“解决之道”而非“问题成因”，关注“未来”而非“过去”。",
                    process: "咨询师不分析你为什么痛苦，而是问：“奇迹问句”（如果明天醒来问题消失了，生活会是什么样？）和“例外问句”（过去有没有哪次你原本会痛苦，但最后应对得还不错？）。通过复制成功的经验，滚雪球般带来改变。",
                    suitability: "适合面临具体生活困境、希望短时间内（甚至1-3次）看到改变、不愿深挖创伤的人。"
                },
                "REBT (理性情绪疗法)": {
                    summary: "CBT的先驱，风格更加犀利和哲学化。",
                    philosophy: "由阿尔伯特·埃利斯创立。认为心理困扰主要源于绝对化的非理性信念（Musts），如“我必须被所有人喜欢”、“事情必须按我的意愿发展”。",
                    process: "治疗师会通过积极、甚至具有对抗性的辩论，挑战来访者的非理性信念。它教导一种“无条件的自我接纳”，即即便我做错了事，我依然是一个有价值的人。",
                    suitability: "适合逻辑思维强、容易陷入完美主义或自我苛责、能接受直率反馈的人。"
                },
                "心理动力学 (Psychodynamic)": {
                    summary: "经典精神分析的现代改良版，更注重现实适应。",
                    philosophy: "认为当下的症状是潜意识冲突的妥协，也是早年人际关系的强迫性重复。虽然不像传统分析那么高频，但依然重视潜意识、防御机制和移情。",
                    process: "通过自由谈话，治疗师帮助来访者识别当下的行为模式如何与过去的经历（特别是童年）相连。重点在于修通“情感体验”，而不仅仅是理智上的明白。关系本身就是治疗的工具。",
                    suitability: "适合想要从根源上改变性格结构、探索人际关系模式、有一定内省能力的人。"
                },
                "精神分析 (Psychoanalysis)": {
                    summary: "心理学的基石，一场深度的人格重构之旅。",
                    philosophy: "认为潜意识决定命运。通过探索被压抑的欲望、冲突和幻想，将潜意识意识化，从而获得真正的心理自由。",
                    process: "通常需要高频次设置（每周3-5次），使用躺椅。核心技术是自由联想（毫无保留地在这个空间里说出脑海中闪过的任何东西）和梦的解析。这通常是一个漫长的过程（数年）。",
                    suitability: "适合有强烈探索自我欲望、不仅仅为了消除症状、经济和时间充裕的人。"
                },
                "客体关系疗法": {
                    summary: "精神分析的重要分支，聚焦于“关系的内化”。",
                    philosophy: "认为“自我”是在与他人的互动中形成的。我们内心都住着早年重要他人（客体）的影子。心理问题源于我们把旧的关系剧本（如“我是会被抛弃的”）投射到了现在的人身上。",
                    process: "治疗师提供一个“抱持性环境”（Holding Environment），充当一个足够好的客体。来访者在安全的关系中，重新体验并修复早年的依恋创伤，建立健康的自体感。",
                    suitability: "适合在亲密关系中反复受挫、缺乏安全感、有依恋创伤（如被忽视、被侵入）的人。"
                },
                "SE (躯体体验疗法)": {
                    summary: "基于神经生物学的创伤治疗，无需大量言语。",
                    philosophy: "由彼得·莱文创立。认为创伤不是一种心理疾病，而是神经系统的生理反应。当动物遇到威胁时的能量（打或逃）没有释放出去，就会冻结在身体里形成创伤。",
                    process: "不强迫来访者讲述痛苦的回忆（以免二次创伤）。通过关注身体的细微感觉（震颤、温度、紧绷），引导神经系统一点点释放积压的生存能量（Titration），恢复弹性。",
                    suitability: "适合PTSD（创伤后应激障碍）、经历过车祸/手术/暴力、容易惊恐发作或解离的人。"
                },
                "舞动治疗": {
                    summary: "艺术治疗的一种，让身体成为表达的出口。",
                    philosophy: "身心是一体的，身体姿态直接影响情绪状态。许多前语言期（婴儿期）的创伤无法用语言描述，但身体记得。",
                    process: "通过即兴的动作、姿态模仿和节奏律动，将来访者无法言说的情绪“演”出来。一个伸展可能代表渴望，一个跺脚可能释放愤怒。它绕过理性的防御，直接工作于潜意识。",
                    suitability: "适合理性防御过强（说得头头是道但没感觉）、情感压抑或不善言辞的人。"
                },
                "正念疗法 (MBCT/MBSR)": {
                    summary: "结合东方禅修智慧与西方心理学的训练。",
                    philosophy: "核心是“有意识地觉察当下，且不加评判”。痛苦往往源于对痛苦的抗拒或对未来的担忧。正念教导我们像观察云朵一样观察自己的念头和情绪。",
                    process: "包含身体扫描、正念呼吸、正念行走等练习。训练大脑从“行动模式”（解决问题）切换到“存在模式”（允许当下），从而打破反刍思维的恶性循环。",
                    suitability: "适合复发性抑郁、焦虑症、慢性疼痛、压力管理以及希望提升生活质量的人。"
                },
                "聚焦 (Focusing)": {
                    summary: "一种向内倾听身体智慧的温和技术。",
                    philosophy: "由简德林发现，心理治疗成功的关键在于来访者能否接触到身体内部模糊的“体会”（Felt Sense）。",
                    process: "引导来访者把注意力放在躯干（胸腹部），去感受那个模糊的“感觉”。通过寻找合适的词语或图像来描述它（如“像一块沉重的石头”），一旦描述准确，身体会有明显的释放感（Felt Shift）。",
                    suitability: "适合感觉自己与内心断联、不知道自己真实感受是什么、希望深入直觉的人。"
                },
                "IFS (内部家庭系统)": {
                    summary: "将内心视为一个微型社会，强调“部分”的和谐。",
                    philosophy: "认为人格不是单一的，而是由许多“部分”（Parts）组成（如严厉的管理者、受伤的流放者）。所有部分都有积极意图。核心自我（Self）具有治愈力。",
                    process: "治疗师帮助来访者从“与部分融合”的状态中抽离出来，去好奇、倾听并安抚那些极端的保护者部分，最终救赎受伤的流放者，让系统恢复平衡。",
                    suitability: "适合内心冲突强烈、自我批评严重、有成瘾行为或复杂创伤的人。"
                },
                "家庭治疗 (Family Therapy)": {
                    summary: "从“关系系统”的角度看问题，而非个人病理。",
                    philosophy: "“孩子是家庭的镜子”。个体的症状往往是家庭系统功能失调的表现（例如孩子生病是为了挽留要离婚的父母）。",
                    process: "通常邀请家庭成员共同参与。观察家庭的沟通模式、权力结构、三角关系和代际传承。通过扰动僵化的互动模式，促使整个系统发生改变，个人的症状随之消失。",
                    suitability: "适合青少年问题（厌学、网瘾）、夫妻伴侣咨询、家庭关系紧张的情况。"
                },
                "萨提亚模式": {
                    summary: "注重成长、自尊与沟通的体验式流派。",
                    philosophy: "人本主义取向，相信人有成长的潜能。关注“冰山”水面下的渴望（爱、接纳、价值感）。认为问题本身不是问题，如何应对问题才是问题。",
                    process: "使用家庭雕塑（用身体姿势呈现关系）、沟通姿态（讨好/指责/超理智/打岔）等体验式技术。目标是提升自我价值感，让沟通变得“一致性”（心口如一）。",
                    suitability: "适合希望提升自尊、改善亲密关系、探索原生家庭影响的人。"
                },
                "叙事疗法 (Narrative Therapy)": {
                    summary: "极具人文关怀的后现代流派，重写生命故事。",
                    philosophy: "人是被故事建构的。痛苦往往源于我们被社会主流话语（如“成功学”、“男儿有泪不轻弹”）压迫，形成了一个“问题故事”。",
                    process: "将人与问题剥离（外化技术）。寻找“例外事件”（那些没被问题打败的时刻），通过“丰厚”这些支线故事，帮助来访者夺回定义自己人生的权力，重构身份认同。",
                    suitability: "适合被标签化（如“病人”、“失败者”）困扰、遭受社会压迫或寻求生命意义的人。"
                },
                "ACT (接纳承诺疗法)": {
                    summary: "认知行为疗法的第三浪潮，强调心理灵活性。",
                    philosophy: "痛苦是人类经验不可避免的一部分。试图控制或消除痛苦（经验回避）往往是导致病理的原因。",
                    process: "六大核心过程：接纳、认知解离（看清想法只是想法）、接触当下、观察性自我、明确价值观、承诺行动。它不教你如何消除焦虑，而是教你如何带着焦虑，去过你想要的生活。",
                    suitability: "适合长期受情绪困扰但想恢复生活功能、对人生方向迷茫的人。"
                },
                "人本主义/存在主义": {
                    summary: "回归“人”本身，强调真实的关系与终极关怀。",
                    philosophy: "人本主义相信人有自我实现的本能（像种子发芽）；存在主义关注死亡、自由、孤独和无意义感。两者都认为“咨访关系”是治疗的核心。",
                    process: "不强调特定技术，而是提供无条件的积极关注、真诚和共情。在这个安全的空间里，来访者重新发现自己的力量，承担选择的责任，活出真实的自己。",
                    suitability: "适合处于人生转折点、感到空虚无意义、渴望被深度理解和接纳的人。"
                },
                "整合式心理咨询 (Integrative Therapy)": {
                    summary: "博采众长，量身定制的折衷主义。",
                    philosophy: "认为没有一种流派能解决所有人的所有问题。根据来访者的性格、问题类型和阶段，灵活整合不同流派的技术。",
                    process: "治疗师可能在初期使用CBT缓解症状，中期用动力学探索根源，后期用人本主义促进成长。这要求治疗师具有极高的专业整合能力。",
                    suitability: "适合大多数有着复杂需求、不确定自己适合什么流派的人。"
                },
                "荣格分析心理学": {
                    summary: "探索灵魂深处，关注集体潜意识与原型。",
                    philosophy: "比起弗洛伊德，荣格更关注人类精神的超越性。认为人生的目标是“个性化”（Individuation），即整合人格的面具与阴影，成为完整的自己。",
                    process: "高度重视梦、沙盘、绘画和积极想象。探索原型意象（如阿尼玛/阿尼姆斯、智者、英雄）。关注中年危机和灵性成长。",
                    suitability: "适合中年转型期、对梦境/神话/艺术/宗教感兴趣、追求精神深度的人。"
                }
            };

            const QUESTIONS = [
                {
                    id: 1,
                    scenario: "关于焦虑",
                    question: "在重要考核前感到心脏狂跳、手心出汗时，当事人本能地认为最有效的应对方式是？",
                    options: [
                        { text: "给自己讲道理，列出证据告诉自己“这很安全”，用脑子压住恐惧。", dimension: 'rationality' },
                        { text: "不瞎想，专心感受脚踩地板的实感，做深呼吸，让身体慢慢松弛下来。", dimension: 'somatic' },
                        { text: "想象心里有个被吓坏的小孩，用大人的语气温柔地哄哄他。", dimension: 'systemic' },
                        { text: "承认自己就是很慌，但不赶走它，带着这种心跳加速的感觉硬着头皮上。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 2,
                    scenario: "关于坏习惯",
                    question: "一个人明知熬夜或刷手机不好却停不下来，深层原因往往是？",
                    options: [
                        { text: "脑子里的“奖赏回路”养成了习惯，得靠刻意练习来建立新规矩。", dimension: 'rationality' },
                        { text: "这是一种无声的反抗，好像只有在深夜，时间才真正属于自己。", dimension: 'insight' },
                        { text: "心里有两个小人在打架：想健康的“管家”管不住那个想放纵的“孩子”。", dimension: 'systemic' },
                        { text: "因为当事人觉得自己就是个“自律差”的人，破罐子破摔了。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 3,
                    scenario: "关于抑郁",
                    question: "抑郁症患者常感到毫无动力。这种状态本质上更像是？",
                    options: [
                        { text: "脑子卡住了，陷入了“我很差、世界很坏、未来没戏”的死循环里。", dimension: 'rationality' },
                        { text: "那是对自己发火。本来对别人的气没发出去，转过头来攻击自己了。", dimension: 'insight' },
                        { text: "像动物遇到天敌时的“装死”反应，为了保命，身体自动切断了电源。", dimension: 'somatic' },
                        { text: "好像被一只叫“抑郁”的大黑狗缠住了，它挡住了原本的光芒。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 4,
                    scenario: "身体的不适",
                    question: "去医院检查没病，但总是胸口压抑、喉咙堵塞。这通常说明？",
                    options: [
                        { text: "那些嘴上没说出来的委屈，变成了身体上的病痛。", dimension: 'insight' },
                        { text: "就是压力太大了，导致神经紧绷，需要调整心态放松一下。", dimension: 'rationality' },
                        { text: "身体还记得过去受过的惊吓，像卡带了一样停在那个紧张的时刻。", dimension: 'somatic' },
                        { text: "可能是身边的环境（家庭或职场）让人窒息，身体比脑子先感觉到了不对劲。", dimension: 'systemic' }
                    ]
                },
                {
                    id: 5,
                    scenario: "关于自我",
                    question: "人的内心结构，听起来最像什么？",
                    options: [
                        { text: "一台复杂的电脑。硬件大家都一样，关键是装了什么软件（想法和观念）。", dimension: 'rationality' },
                        { text: "一座冰山。露在水面上的理智很少，水面下看不见的潜意识才是主宰。", dimension: 'insight' },
                        { text: "一个大家庭。心里住着好多性格不同的小人，健康就是让他们别打架。", dimension: 'systemic' },
                        { text: "一本正在写的书。没有固定的“我”，人是在不断讲故事中定义自己的。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 6,
                    scenario: "关于过去",
                    question: "童年经历对现在的影响有多大？",
                    options: [
                        { text: "影响非常大。小时候的经历是地基，不看清地基，楼就修不好。", dimension: 'insight' },
                        { text: "有影响，但不是绝对的。关键是你现在怎么看它，人可以不受过去的摆布。", dimension: 'rationality' },
                        { text: "过去不仅仅是记忆，更是一种刻在神经里的生理反应习惯。", dimension: 'somatic' },
                        { text: "过去只是素材。同样的经历，我们可以把它讲成悲剧，也可以讲成英雄剧。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 7,
                    scenario: "关于愤怒",
                    question: "当感到极度愤怒时，最健康的心理处理方式是？",
                    options: [
                        { text: "先冷静下来，想想这火发得有没有道理，怎么沟通才能解决问题。", dimension: 'rationality' },
                        { text: "找个安全的地方吼出来、打打枕头，把身体里这股火气排出去。", dimension: 'somatic' },
                        { text: "往心里深处看一看，愤怒底下是不是藏着委屈、害怕或者无助？", dimension: 'insight' },
                        { text: "问问心里那个愤怒的部分：“你发这么大火，是在努力保护我什么吗？”", dimension: 'systemic' }
                    ]
                },
                {
                    id: 8,
                    scenario: "关于梦境",
                    question: "如果做了一个很奇怪的梦，该如何看待它？",
                    options: [
                        { text: "那就是大脑在清理白天的垃圾信息，不用太在意，睡醒了就过日子。", dimension: 'rationality' },
                        { text: "梦是通往内心深处的密道，里面可能藏着被压抑的愿望。", dimension: 'insight' },
                        { text: "梦里的每个人物可能都是你自己性格的一个侧面，试着演演他们。", dimension: 'systemic' },
                        { text: "不管合不合逻辑，去体会梦里的那种情绪和氛围，它本身就有美感和意义。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 9,
                    scenario: "理想的咨询师",
                    question: "在你的想象中，理想的心理咨询师应该怎么做？",
                    options: [
                        { text: "能够提供具体的方法，教授应对技巧，帮助分析利弊，督促做出改变。", dimension: 'rationality' },
                        { text: "能够陪伴一起挖掘记忆的废墟，找到那些被遗忘的真相。", dimension: 'insight' },
                        { text: "不需要说太多，只要稳稳地接住情绪，让人觉得安全。", dimension: 'somatic' },
                        { text: "能够帮助协调内心打架的那些声音，或者理顺糟糕的人际关系。", dimension: 'systemic' }
                    ]
                },
                {
                    id: 10,
                    scenario: "咨询中的沉默",
                    question: "如果在咨询中两个人都不说话，沉默了两分钟，这通常意味着？",
                    options: [
                        { text: "这有点浪费时间，或者太尴尬了，应该赶紧找个话题打破沉默。", dimension: 'rationality' },
                        { text: "这可能是我潜意识里不想面对什么，或者在对抗咨询师，值得分析一下。", dimension: 'insight' },
                        { text: "挺好的，正好趁机感受一下当下的呼吸和身体感觉，让情绪沉淀一会儿。", dimension: 'somatic' },
                        { text: "这是一种无声的陪伴。即使不说话，两个人在一起本身就很治愈。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 11,
                    scenario: "改变的关键",
                    question: "一个人要发生根本性的改变，最关键的那个瞬间通常是？",
                    options: [
                        { text: "突然一下子看清了自己这么多年循环的根源，“啊！原来是因为这个！”", dimension: 'insight' },
                        { text: "换了个角度看死胡同，突然发现原来还有这种解决办法。", dimension: 'rationality' },
                        { text: "本来以为会被批评，结果对方却给了我温柔的回应，那一刻心里的旧伤好了。", dimension: 'systemic' },
                        { text: "紧绷多年的肩膀突然松下来了，一口长气终于呼出去了，身体觉得安全了。", dimension: 'somatic' }
                    ]
                },
                {
                    id: 12,
                    scenario: "选择困难",
                    question: "当在两个人生选项中犹豫不决时，最好的决策依据是？",
                    options: [
                        { text: "画个表，列出优缺点打分，算出哪个选项性价比最高。", dimension: 'rationality' },
                        { text: "问自己哪个选择能活出自己最看重的价值，即使那条路更难走。", dimension: 'meaning' },
                        { text: "闭上眼分别带入一下，看看身体是感觉发紧（不要）还是舒展（要）。", dimension: 'somatic' },
                        { text: "听听心里的不同声音，看看是哪个部分想选A，哪个部分想选B，协调一下。", dimension: 'systemic' }
                    ]
                },
                {
                    id: 13,
                    scenario: "伴侣吵架",
                    question: "如果伴侣之间总是因为鸡毛蒜皮的小事吵架，问题通常出在？",
                    options: [
                        { text: "可能是因为沟通方式不对，需要学习怎么好好说话，控制情绪。", dimension: 'rationality' },
                        { text: "看走了眼。其实是把小时候对父母的气，撒到了眼前这个无辜的人身上。", dimension: 'insight' },
                        { text: "舞步乱了。不是谁的错，而是两人陷入了“一个追、一个逃”的恶性循环。", dimension: 'systemic' },
                        { text: "被吓到了。吵架触发了身体里对于“被抛弃”或“被吞没”的原始恐惧。", dimension: 'somatic' }
                    ]
                },
                {
                    id: 14,
                    scenario: "关于空虚",
                    question: "感到人生虚无、没有意义时，比较好的应对是？",
                    options: [
                        { text: "别闲着，定个小目标动起来。忙起来了，充实感就回来了。", dimension: 'rationality' },
                        { text: "这是小时候缺爱留下的黑洞。需要回到过去，修补那个情感缺口。", dimension: 'insight' },
                        { text: "不用急着填满，试着和这种空虚待一会儿，也许这正是重新定义人生的机会。", dimension: 'meaning' },
                        { text: "去摸摸泥土，闻闻花香，抱抱大树，从身体的真实触感中找回活着的感觉。", dimension: 'somatic' }
                    ]
                },
                {
                    id: 15,
                    scenario: "关于评价",
                    question: "为什么人们会那么在意别人的看法？",
                    options: [
                        { text: "因为脑子里有个错误信念，觉得“我必须让每个人都喜欢我”，这不科学。", dimension: 'rationality' },
                        { text: "其实是在意心里住着的那个严厉的父母，那个批评的声音内化了。", dimension: 'insight' },
                        { text: "这是被社会洗脑了。大家都说那样才算成功，我们不自觉地被绑架了。", dimension: 'meaning' },
                        { text: "这是动物本能。在原始社会，被群体排斥就意味着死，身体会本能地害怕。", dimension: 'somatic' }
                    ]
                },
                {
                    id: 16,
                    scenario: "关于痛苦",
                    question: "如果痛苦无法避免（如生老病死），该如何面对？",
                    options: [
                        { text: "既然躲不掉，就背着它上路，把精力花在对自己真正重要的事情上。", dimension: 'meaning' }, 
                        { text: "改变能改变的，接受不能改变的，尽量保持乐观心态。", dimension: 'rationality' },
                        { text: "允许自己找个安全的地方大哭一场，彻底宣泄出悲伤，别憋着。", dimension: 'insight' }, 
                        { text: "回到家人朋友身边，通过和别人的连接来汲取力量，不要一个人扛。", dimension: 'systemic' }
                    ]
                },
                {
                    id: 17,
                    scenario: "谁负责改变",
                    question: "在心理咨询中，谁应该对“治好”负责？",
                    options: [
                        { text: "主要是来访者自己。咨询师只是向导，路还得自己走，练习得自己做。", dimension: 'rationality' },
                        { text: "是两个人共同负责。这段关系的质量本身就是药，双方互动好了，病就好了。", dimension: 'systemic' }, 
                        { text: "看潜意识的心情。有时候改变是自然发生的，咨询只是提供了一个催化环境。", dimension: 'insight' },
                        { text: "这是个伪命题。重点不是“消灭症状”，而是学会怎么和症状和平共处。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 18,
                    scenario: "关于直觉",
                    question: "做决定时，应该多大程度上相信直觉（第六感）？",
                    options: [
                        { text: "不太可信。直觉往往是脑子偷懒，还是数据和逻辑分析更靠谱。", dimension: 'rationality' },
                        { text: "很相信。直觉是身体的智慧，脑子会骗人，但肠胃的反应不会骗人。", dimension: 'somatic' },
                        { text: "得小心点。直觉可能是潜意识的洞察，也可能是“一朝被蛇咬”的创伤反应。", dimension: 'insight' },
                        { text: "直觉是心里某个“部分”的声音，值得听听，但不能只听它一个人的。", dimension: 'systemic' }
                    ]
                },
                {
                    id: 19,
                    scenario: "关于“正常”",
                    question: "什么是理想的心理健康状态？",
                    options: [
                        { text: "适应能力强。能正常工作生活，情绪稳定，没啥大毛病。", dimension: 'rationality' },
                        { text: "通透。对自己了解得很深，能接纳自己阴暗的一面，不拧巴。", dimension: 'insight' },
                        { text: "流动。身体不僵硬，能量是活的，能兴奋也能放松。", dimension: 'somatic' },
                        { text: "真实。活得像自己，哪怕有痛苦，也是鲜活的、有血有肉的。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 20,
                    scenario: "不想去咨询",
                    question: "如果发现自己总是迟到或者不想去见咨询师，这通常说明？",
                    options: [
                        { text: "意志力不够坚定，在逃避困难。需要定个计划克服拖延症。", dimension: 'rationality' },
                        { text: "这是为了保护自己，心里有些部分觉得还没准备好去揭伤疤。", dimension: 'systemic' },
                        { text: "可能对咨询师有了某种情绪（比如像在反抗古板的权威），值得聊聊。", dimension: 'insight' },
                        { text: "身体在抗拒，也许咨询的节奏太快了，让人感觉不安全。", dimension: 'somatic' }
                    ]
                },
                {
                    id: 21,
                    scenario: "家庭聚会",
                    question: "春节回家，亲戚的盘问让人很烦。这反映了？",
                    options: [
                        { text: "他们缺乏界限感。需要学习怎么温和而坚定地拒绝。", dimension: 'rationality' },
                        { text: "那一刻，人好像变回了小时候那个无力反抗的小孩，在重复当年的感觉。", dimension: 'insight' },
                        { text: "这是一种默契的配合。如果你不演“被催婚的可怜虫”，七大姑八大姨的焦虑就没处放了。", dimension: 'systemic' },
                        { text: "这只是社会主流价值观在念经。他们只是复读机，你不必认同。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 22,
                    scenario: "关于创伤记忆",
                    question: "对于那些痛苦的记忆，最理想的处理结果是？",
                    options: [
                        { text: "最好能淡忘，想起来的时候内心毫无波澜，不再难受。", dimension: 'rationality' },
                        { text: "彻底搞清楚。找回缺失的记忆拼图，明白到底发生了什么，才能翻篇。", dimension: 'insight' },
                        { text: "不需要全部想起来。只要身体感觉安全了，记忆模糊一点也没关系。", dimension: 'somatic' },
                        { text: "把它编进人生故事里。它是我经历的一部分，但它不能定义我是谁。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 23,
                    scenario: "关于多面性",
                    question: "有时候人会觉得自己像变了个人（比如职场上很凶，家里很怂），这是？",
                    options: [
                        { text: "很正常，在不同场合戴不同面具，说明适应能力强。", dimension: 'rationality' },
                        { text: "这些都是自我的不同侧面（零件），每个侧面出来都是为了帮我们应对环境。", dimension: 'systemic' },
                        { text: "这可能反映了内心不太整合，像分裂成了几块，需要统合起来。", dimension: 'insight' },
                        { text: "本来就没有固定的“我”，人就是随着关系和环境像水一样流动的。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 24,
                    scenario: "关于说话",
                    question: "在咨询中，“说话”的主要作用是？",
                    options: [
                        { text: "向咨询师描述问题，好让对方给建议和反馈。", dimension: 'rationality' },
                        { text: "说话是打开潜意识大门的钥匙，说什么不重要，顺嘴溜出来的才重要。", dimension: 'insight' },
                        { text: "语言创造现实。换一种叙述方式，就是换一种活法。", dimension: 'meaning' },
                        { text: "语言的作用有限。很多深层感觉是说不出来的，得靠非语言的默契。", dimension: 'somatic' }
                    ]
                },
                {
                    id: 25,
                    scenario: "关于独处",
                    question: "一个人独处时感到恐慌，往往是因为？",
                    options: [
                        { text: "没培养出什么兴趣爱好，闲下来不知道干嘛，时间太难熬。", dimension: 'rationality' },
                        { text: "心里觉得空荡荡的，好像只要没人陪，自己就要消失了。", dimension: 'insight' },
                        { text: "习惯了在关系里找存在感，没人给反馈，就觉得自己不存在了。", dimension: 'systemic' },
                        { text: "直面了“人原本就是孤独的”这个真相，这种虚无感让人害怕。", dimension: 'meaning' }
                    ]
                },
                {
                    id: 26,
                    scenario: "咨询的目标",
                    question: "如果咨询很成功，结束时的理想状态是？",
                    options: [
                        { text: "现实问题解决了，症状消失，掌握了应对未来挑战的技能。", dimension: 'rationality' },
                        { text: "活明白了。知道自己性格怎么来的，不再掉进同一个坑里。", dimension: 'insight' },
                        { text: "活出了自己。找到了人生的奔头，哪怕带着伤疤，也能活得精彩。", dimension: 'meaning' },
                        { text: "身心通透。身体感觉安全、放松，能敏锐感觉到自己的状态变化。", dimension: 'somatic' }
                    ]
                },
                {
                    id: 27,
                    scenario: "世界观",
                    question: "如果要把心理世界浓缩成一句话，你更认同哪一句？",
                    options: [
                        { text: "世界是客观的，痛苦源于我们错误的看法。修正了想法，世界就清朗了。", dimension: 'rationality' },
                        { text: "看不见的潜意识在暗中操控着命运，只有看见它，我们才能从宿命中醒来。", dimension: 'insight' },
                        { text: "身体比大脑更诚实。大脑会骗人，会编故事，但身体的感觉永远记录着真相。", dimension: 'somatic' },
                        { text: "没有人是一座孤岛。我们都是关系网里的节点，牵一发而动全身。", dimension: 'systemic' }
                    ]
                }
            ];

            const handleNext = () => {
                if (currentQuestionIndex < QUESTIONS.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    setCurrentStep('result');
                }
            };

            const handleOptionSelect = (dimension) => {
                setScores(prev => ({
                    ...prev,
                    [dimension]: prev[dimension] + 1
                }));
                handleNext();
            };

            const handleSkip = () => {
                setSkippedCount(prev => prev + 1);
                handleNext();
            };

            const restartQuiz = () => {
                setScores({ rationality: 0, insight: 0, somatic: 0, systemic: 0, meaning: 0 });
                setSkippedCount(0);
                setCurrentQuestionIndex(0);
                setCurrentStep('intro');
                setSelectedTherapy(null);
                setActiveDimensionInfo(null);
            };

            useEffect(() => {
                if (selectedTherapy && resultRef.current) {
                    resultRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, [selectedTherapy]);

            const getResultAnalysis = () => {
                const totalScore = Object.values(scores).reduce((a, b) => a + b, 0);
                
                if (totalScore < 3) {
                    return {
                        title: "神秘的漫游者",
                        desc: "由于数据太少，无法绘制精确的心灵地图。这可能意味着你不愿被简单的选项定义，或者你在寻找一种超越常规的体验。",
                        therapies: ["存在主义疗法", "精神分析"],
                        advice: "建议寻找一位包容性极强、不预设框架的资深咨询师，从开放式对话开始。",
                        isInsufficient: true
                    };
                }

                const sortedDims = Object.entries(scores).sort((a, b) => b[1] - a[1]);
                const topDimKey = sortedDims[0][0];
                const topScore = sortedDims[0][1];
                const isBalanced = topScore < (totalScore * 0.32); 

                if (isBalanced) {
                    return {
                        title: "全息整合者 (The Holistic Integrator)",
                        desc: "你的心灵地图令人惊讶地平衡。你既尊重理性的力量，也敬畏潜意识的深邃；既能感知身体的律动，也看重关系的连接。你可能是一个天然的“整合者”，单一流派很难满足你。",
                        therapies: ["整合式心理咨询 (Integrative Therapy)", "荣格分析心理学", "人本主义/存在主义"],
                        advice: "寻找一位“整合取向”的资深咨询师，他需要能根据你的不同状态，灵活切换工作频道。"
                    }
                }
                
                const analysisLib = {
                    rationality: {
                        title: "理性建筑师 (The Rational Architect)",
                        desc: "你拥有一颗科学家般的大脑。在你看来，情绪是可以被理解的信号，而痛苦往往源于“错误的计算”或“技能的缺失”。你不需要模糊的安慰，你渴望清晰的逻辑、具体的行动方案和可验证的改变。你相信大脑具有可塑性，通过训练可以重塑人生。",
                        therapies: ["CBT (认知行为疗法)", "SFBT (焦点解决短期治疗)", "REBT (理性情绪疗法)"],
                        advice: "寻找咨询师时，直接问：“你的咨询过程是结构化的吗？我们会设定具体目标并布置练习吗？”"
                    },
                    insight: {
                        title: "深渊潜水员 (The Deep Diver)",
                        desc: "你拥有深邃的灵魂，不满足于表面的风平浪静。你深信“过去即现在”——当下的每一个症状，都是过去幽灵的回响。对你来说，快速消除症状是肤浅的，甚至是一种逃避。你渴望理解痛苦背后的意义，愿意潜入潜意识的深海，去打捞那些被遗忘的宝藏。",
                        therapies: ["心理动力学 (Psychodynamic)", "精神分析 (Psychoanalysis)", "客体关系疗法", "荣格分析心理学"],
                        advice: "寻找咨询师时，确认你们是否会深入探讨过去、童年经历或梦境如何影响现在。"
                    },
                    somatic: {
                        title: "身心共鸣者 (The Somatic Resonator)",
                        desc: "你相信身体比大脑更诚实。你敏锐地察觉到，很多道理头脑都懂，但身体做不到。对你而言，创伤不是一段记忆，而是锁在神经系统里的一股冻结的能量。真正的治愈是通过呼吸、震颤和流动，让身体从“生存模式”回归到“安全模式”。",
                        therapies: ["SE (躯体体验疗法)", "舞动治疗", "正念疗法 (MBCT/MBSR)", "聚焦 (Focusing)"], 
                        advice: "询问咨询师：“除了谈话，你是否会使用关注身体感觉（Felt Sense）或调节神经系统的方法？”"
                    },
                    systemic: {
                        title: "内在调解员 (The Inner Mediator)",
                        desc: "你从不把人看作孤岛。你拥有一种“生态视角”：或者你认为人的内心是一个由不同声音（部分）组成的微型社会；或者你认为人的问题是家庭/社会系统失衡的产物。你追求的不是消灭某个症状，而是达成内部或外部系统的和谐与平衡。",
                        therapies: ["IFS (内部家庭系统)", "家庭治疗 (Family Therapy)", "萨提亚模式"],
                        advice: "询问咨询师是否熟悉“零件心理学”(IFS)视角，或者是否愿意从家庭系统的角度看问题。"
                    },
                    meaning: {
                        title: "故事重构者 (The Story Alchemist)",
                        desc: "你具有哲学家或艺术家的气质。你认为现实是被建构出来的，痛苦往往源于我们被社会强加了狭隘的“标签”。你不寻求被“治好”（因为你没病），你寻求的是重写人生剧本的权力，以及在不可避免的苦难中，活出自己独特的价值和意义。",
                        therapies: ["叙事疗法 (Narrative Therapy)", "ACT (接纳承诺疗法)", "人本主义/存在主义"],
                        advice: "询问咨询师：“你如何看待诊断标签？你会如何帮助我找到生活的意义，而不仅仅是消除症状？”"
                    }
                };

                return analysisLib[topDimKey];
            };

            // --- Views ---
            if (currentStep === 'intro') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 flex flex-col items-center justify-center p-6 font-sans text-slate-800">
                        <div className="max-w-md w-full bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl overflow-hidden p-8 text-center border-t-8 border-indigo-500">
                            <div className="flex justify-center mb-8 relative">
                                <div className="bg-indigo-50 p-6 rounded-full relative z-10">
                                    <Icons.Compass className="w-14 h-14 text-indigo-600 animate-pulse" />
                                </div>
                                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-indigo-100 rounded-full blur-xl opacity-50"></div>
                            </div>
                            <h1 className="text-2xl sm:text-3xl font-extrabold mb-2 text-slate-900 tracking-tight">心理咨询流派匹配测验</h1>
                            <p className="text-xs uppercase tracking-[0.2em] text-indigo-500 font-bold mb-8">Psychotherapy Orientation Match</p>
                            <p className="text-slate-600 mb-8 leading-relaxed text-base">
                                这是一个深度的心理学流派匹配测评。<br/>
                                包含 <strong>27个</strong> 具有临床意义的情境。<br/><br/>
                                它不评判对错，只寻找共鸣。<br/>
                                请跟随直觉，找到最懂你的心理学流派。
                            </p>
                            <div className="space-y-4">
                                <button 
                                    onClick={() => setCurrentStep('quiz')}
                                    className="w-full bg-indigo-600 hover:bg-indigo-700 active:scale-95 text-white font-bold py-4 px-6 rounded-2xl transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-indigo-500/30"
                                >
                                    开始探索
                                    <Icons.ArrowRight className="w-5 h-5" />
                                </button>
                                <p className="text-xs text-slate-400 font-medium">预计耗时 5-8 分钟 | 27 题</p>
                            </div>
                        </div>
                    </div>
                );
            }

            if (currentStep === 'quiz') {
                const question = QUESTIONS[currentQuestionIndex];
                const progress = ((currentQuestionIndex + 1) / QUESTIONS.length) * 100;

                return (
                    <div className="min-h-screen bg-slate-50 flex flex-col items-center p-4 sm:p-6 font-sans transition-colors duration-500">
                        <div className="w-full max-w-2xl mt-4 sm:mt-10">
                            <div className="flex justify-between items-center mb-6 px-2">
                                <span className="text-sm font-bold text-slate-400">Q{currentQuestionIndex + 1} / {QUESTIONS.length}</span>
                                <div className="h-2 w-32 bg-slate-200 rounded-full overflow-hidden">
                                    <div className="h-full bg-indigo-500 transition-all duration-500 ease-out" style={{ width: `${progress}%` }}></div>
                                </div>
                            </div>

                            <div className="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-6 sm:p-10 mb-6 border border-white">
                                <div className="flex items-center gap-2 mb-4">
                                    <span className="px-3 py-1 bg-indigo-50 text-indigo-600 text-xs font-bold rounded-full uppercase tracking-wider">
                                        {question.scenario}
                                    </span>
                                </div>
                                
                                <h3 className="text-xl sm:text-2xl font-bold text-slate-800 leading-snug mb-8">
                                    {question.question}
                                </h3>

                                <div className="grid gap-3">
                                    {question.options.map((option, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => handleOptionSelect(option.dimension)}
                                            className="group relative w-full flex items-start p-5 rounded-2xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50/50 hover:shadow-md transition-all duration-200 text-left"
                                        >
                                            <div className="flex-shrink-0 mt-0.5 mr-4 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                <div className="w-5 h-5 rounded-full border-2 border-current flex items-center justify-center">
                                                    <div className="w-2.5 h-2.5 rounded-full bg-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity" />
                                                </div>
                                            </div>
                                            <span className="text-slate-600 group-hover:text-slate-900 font-medium text-base sm:text-lg leading-relaxed">
                                                {option.text}
                                            </span>
                                        </button>
                                    ))}
                                </div>

                                <div className="mt-6 pt-4 border-t border-slate-50 flex justify-center">
                                    <button 
                                        onClick={handleSkip}
                                        className="text-slate-400 hover:text-slate-600 text-sm font-medium flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-slate-50 transition-colors"
                                    >
                                        <Icons.SkipForward className="w-4 h-4" />
                                        这一题很难选 / 以上都不符合
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (currentStep === 'result') {
                const result = getResultAnalysis();

                return (
                    <div className="min-h-screen bg-slate-50 p-4 sm:p-8 font-sans">
                        <div className="max-w-6xl mx-auto bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-slate-100">
                            
                            {/* Header */}
                            <div className="bg-slate-900 text-white p-10 sm:p-16 text-center relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                                <div className="absolute top-10 left-10 w-32 h-32 bg-blue-500 rounded-full mix-blend-overlay filter blur-3xl opacity-20"></div>
                                <div className="absolute bottom-10 right-10 w-40 h-40 bg-purple-500 rounded-full mix-blend-overlay filter blur-3xl opacity-20"></div>

                                <h2 className="text-base text-slate-400 mb-3 font-medium uppercase tracking-widest flex items-center justify-center gap-2">
                                    <Icons.Sparkles className="w-4 h-4" /> 你的心灵原型
                                </h2>
                                <h1 className="text-4xl sm:text-5xl font-black bg-clip-text text-transparent bg-gradient-to-r from-white via-indigo-100 to-indigo-200 mb-8 leading-tight">
                                    {result.title}
                                </h1>
                                <div className="max-w-3xl mx-auto relative">
                                    <p className="text-lg sm:text-xl text-slate-300 leading-relaxed font-light">
                                        {result.desc}
                                    </p>
                                </div>
                            </div>

                            <div className="grid lg:grid-cols-12 gap-0 min-h-[500px]">
                                
                                {/* Left Column: Visuals & Dimensions */}
                                <div className="lg:col-span-5 p-8 border-b lg:border-b-0 lg:border-r border-slate-100 bg-slate-50/50 flex flex-col">
                                    <div className="w-full flex items-center justify-between mb-4 px-2">
                                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest">能量分布</h3>
                                        {skippedCount > 0 && (
                                            <span className="text-xs text-amber-500 flex items-center gap-1 bg-amber-50 px-2 py-1 rounded-md">
                                                <Icons.AlertCircle className="w-3 h-3" /> 跳过 {skippedCount} 题
                                            </span>
                                        )}
                                    </div>
                                    
                                    <RadarChart data={scores} dimensionsConfig={DIMENSIONS} />
                                    
                                    <div className="w-full space-y-3 mt-4 px-2">
                                        <p className="text-xs text-slate-400 text-center mb-4 flex items-center justify-center gap-1">
                                            <Icons.Info className="w-3 h-3" /> 点击维度名称查看详细解释
                                        </p>
                                        {Object.entries(DIMENSIONS).map(([key, info]) => {
                                            const totalScore = Object.values(scores).reduce((a, b) => Math.max(a, b), 0);
                                            const isTop = key === Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
                                            const isInfoActive = activeDimensionInfo === key;
                                            
                                            return (
                                                <div key={key} className="relative">
                                                    <div 
                                                        className={`flex items-center text-sm p-2 rounded-lg cursor-pointer transition-colors ${isInfoActive ? 'bg-white shadow-sm ring-1 ring-slate-200' : 'hover:bg-slate-100'}`}
                                                        onClick={() => setActiveDimensionInfo(isInfoActive ? null : key)}
                                                    >
                                                        <div className="flex items-center gap-2 w-28">
                                                            <info.icon className="w-4 h-4" style={{ color: info.color }} />
                                                            <span className={`font-medium ${isTop && !result.isInsufficient ? 'text-slate-900' : 'text-slate-600'}`}>
                                                                {info.label}
                                                            </span>
                                                            {isInfoActive ? <Icons.ChevronRight className="w-3 h-3 rotate-90 text-slate-400" /> : <Icons.ChevronRight className="w-3 h-3 text-slate-300" />}
                                                        </div>
                                                        <div className="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden mx-3">
                                                            <div 
                                                                className="h-full rounded-full transition-all duration-1000 ease-out" 
                                                                style={{ 
                                                                    width: totalScore > 0 ? `${(scores[key] / (totalScore + 2)) * 100}%` : '0%', 
                                                                    backgroundColor: info.color 
                                                                }}
                                                            />
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Inline Dimension Info */}
                                                    {isInfoActive && (
                                                        <div className="mx-2 mb-3 p-3 bg-slate-50 border-l-2 border-indigo-400 text-xs text-slate-600 leading-relaxed animate-in fade-in slide-in-from-top-1">
                                                            <strong className="block mb-1 text-slate-800">{DIMENSION_DETAILS[key].title}</strong>
                                                            {DIMENSION_DETAILS[key].desc}
                                                        </div>
                                                    )}
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>

                                {/* Right Column: Recommendations & Interaction */}
                                <div className="lg:col-span-7 p-8 sm:p-12 flex flex-col justify-between bg-white">
                                    <div>
                                        <div className="mb-10">
                                            <div className="flex items-center gap-3 mb-5">
                                                <div className="p-2 bg-indigo-100 rounded-lg text-indigo-600">
                                                    <Icons.BookOpen className="w-6 h-6" />
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-xl text-slate-900">推荐流派</h3>
                                                    <p className="text-xs text-slate-500">点击下方标签，获取详细指南</p>
                                                </div>
                                            </div>
                                            
                                            {/* Interactive Pills */}
                                            <div className="flex flex-wrap gap-3 mb-6">
                                                {result.therapies.map((therapy, i) => {
                                                    const isSelected = selectedTherapy === therapy;
                                                    return (
                                                        <button 
                                                            key={i} 
                                                            onClick={() => setSelectedTherapy(isSelected ? null : therapy)}
                                                            className={`flex items-center gap-2 pl-3 pr-4 py-2 rounded-full text-sm font-medium transition-all duration-200 border
                                                                ${isSelected 
                                                                    ? 'bg-indigo-600 border-indigo-600 text-white shadow-md scale-105' 
                                                                    : 'bg-white border-slate-200 text-slate-700 hover:border-indigo-300 hover:text-indigo-600 hover:bg-indigo-50'
                                                                }`}
                                                        >
                                                            <Icons.CheckCircle2 className={`w-4 h-4 ${isSelected ? "text-indigo-200" : "text-green-500"}`} />
                                                            {therapy}
                                                        </button>
                                                    );
                                                })}
                                            </div>

                                            {/* Dynamic Info Card */}
                                            <div ref={resultRef} className={`relative overflow-hidden transition-all duration-300 ease-in-out ${selectedTherapy ? 'max-h-[800px] opacity-100' : 'max-h-0 opacity-0'}`}>
                                                <div className="bg-gradient-to-br from-indigo-50 to-white rounded-xl p-6 border border-indigo-100 shadow-sm relative">
                                                    <button 
                                                        onClick={() => setSelectedTherapy(null)}
                                                        className="absolute top-3 right-3 p-1 text-indigo-300 hover:text-indigo-600 rounded-full hover:bg-indigo-100 transition-colors"
                                                    >
                                                        <Icons.X className="w-5 h-5" />
                                                    </button>
                                                    <h4 className="font-bold text-indigo-900 mb-4 flex items-center gap-2 text-lg">
                                                        <Icons.Book className="w-5 h-5 text-indigo-500" />
                                                        {selectedTherapy?.split(' (')[0]}
                                                    </h4>
                                                    
                                                    {selectedTherapy && THERAPY_KNOWLEDGE_BASE[selectedTherapy] ? (
                                                        <div className="space-y-4 text-sm text-slate-700">
                                                            <p className="italic text-indigo-600 font-medium">
                                                                {THERAPY_KNOWLEDGE_BASE[selectedTherapy].summary}
                                                            </p>
                                                            
                                                            <div>
                                                                <h5 className="font-bold text-slate-900 mb-1 flex items-center gap-1">
                                                                    <Icons.Sparkles className="w-3.5 h-3.5 text-amber-500"/> 核心理念
                                                                </h5>
                                                                <p className="leading-relaxed pl-5 border-l-2 border-slate-200">
                                                                    {THERAPY_KNOWLEDGE_BASE[selectedTherapy].philosophy}
                                                                </p>
                                                            </div>

                                                            <div>
                                                                <h5 className="font-bold text-slate-900 mb-1 flex items-center gap-1">
                                                                    <Icons.Activity className="w-3.5 h-3.5 text-emerald-500"/> 治疗方式
                                                                </h5>
                                                                <p className="leading-relaxed pl-5 border-l-2 border-slate-200">
                                                                    {THERAPY_KNOWLEDGE_BASE[selectedTherapy].process}
                                                                </p>
                                                            </div>

                                                            <div>
                                                                <h5 className="font-bold text-slate-900 mb-1 flex items-center gap-1">
                                                                    <Icons.CheckCircle2 className="w-3.5 h-3.5 text-blue-500"/> 适合人群
                                                                </h5>
                                                                <p className="leading-relaxed pl-5 border-l-2 border-slate-200">
                                                                    {THERAPY_KNOWLEDGE_BASE[selectedTherapy].suitability}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <p className="text-slate-400 italic">暂无详细介绍。</p>
                                                    )}
                                                </div>
                                            </div>
                                            
                                            {!selectedTherapy && (
                                                <div className="flex items-center gap-2 text-sm text-slate-400 italic bg-slate-50 p-4 rounded-xl border border-dashed border-slate-200">
                                                    <Icons.ArrowRight className="w-4 h-4" /> 试试点击上面的流派标签，这里会显示详细解释。
                                                </div>
                                            )}

                                        </div>

                                        <div className="mb-8 mt-8">
                                            <div className="flex items-center gap-3 mb-5">
                                                <div className="p-2 bg-pink-100 rounded-lg text-pink-600">
                                                    <Icons.Heart className="w-6 h-6" />
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-xl text-slate-900">匹配流派的建议</h3>
                                                    <p className="text-xs text-slate-500">首次访谈的试金石</p>
                                                </div>
                                            </div>
                                            <div className="bg-gradient-to-r from-pink-50 to-orange-50 p-6 rounded-2xl border border-pink-100 shadow-sm">
                                                <p className="text-pink-900 italic font-medium text-lg leading-relaxed">
                                                    “{result.advice}”
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="pt-8 border-t border-slate-100 mt-8 flex flex-col sm:flex-row items-center justify-between gap-4">
                                        <p className="text-xs text-slate-400 max-w-xs">
                                            *结果仅供参考，不作为心理诊断依据。
                                        </p>
                                        <button 
                                            onClick={restartQuiz}
                                            className="flex items-center justify-center gap-2 px-6 py-3 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold rounded-xl transition-all w-full sm:w-auto hover:shadow-md"
                                        >
                                            <Icons.RefreshCw className="w-4 h-4" />
                                            重新测试
                                        </button>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PsychSchoolMatchApp />);
    </script>
</body>
</html>